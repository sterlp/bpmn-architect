

<mat-toolbar>
  BPMN Architect
  <div class="app-spacer"></div>
  <button mat-raised-button color="warn" (click)="doClear()">
    Delete everything
  </button>
  <ng-container [ngTemplateOutlet]="defaultButtons"></ng-container>  
</mat-toolbar>

<ng-template #defaultButtons let-node="node">
  <button mat-icon-button color="primary"
          *ngIf="node" (click)="doEditNode(node)" 
          attr.aria-label="edit  {{node.name}}"
          matTooltip="Edit '{{node.name}}'" [disabled]="this.editElement">
    <mat-icon fontIcon="edit"></mat-icon>
  </button>

  <button mat-icon-button [matTooltip]="node ? 'Add Folder to \'' + node.name + '\'' : 'Add Folder'"
          [attr.aria-label]="node ? 'Add subfolder to {{node.name}}' : 'add folder'"
          *ngIf="isFolder(node) || !node"
          [disabled]="this.editElement" (click)="doAddFolder(node)">
    <mat-icon fontIcon="create_new_folder"></mat-icon>
  </button>

  <button mat-icon-button color="primary" routerLink="/diagrams/new" 
          [queryParams]="toQueryParams(node)" 
          [matTooltip]="node ? 'Add Diagram to \'' + node.name + '\'' : 'Add Diagram'"
          [disabled]="this.editElement" *ngIf="isFolder(node) || !node" >
    <mat-icon fontIcon="add_chart"></mat-icon>
  </button>
  <button mat-icon-button 
          *ngIf="node && node.source?.id"
          [attr.aria-label]="'Delete ' + node.name"
          [disabled]="this.editElement" 
          color="warn" 
          (click)="doDelete(node)"
          matTooltip="Delete '{{ node.name }}'">
    <mat-icon fontIcon="delete"></mat-icon>
  </button>

  <ng-content></ng-content>
</ng-template>

<ng-template #nameAndDate let-node="node">
  <app-bpmn-element-icon class="mr-1" [element]="node"></app-bpmn-element-icon>
  {{node.name}}
  <div class="app-spacer"></div>
  {{node.updateDate | date:'short'}}
  <div class="app-spacer"></div>
</ng-template>

<mat-tree [dataSource]="ds.dataSource" [treeControl]="ds.treeControl">

  <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
    <button mat-icon-button disabled></button>
    <ng-container [ngTemplateOutlet]="nameAndDate" [ngTemplateOutletContext]="{node}"></ng-container>
    <div class="app-spacer"></div>
    <ng-container [ngTemplateOutlet]="defaultButtons" [ngTemplateOutletContext]="{node}"></ng-container>
  </mat-tree-node>

  <mat-tree-node *matTreeNodeDef="let node; when: isEditNode" matTreeNodePadding>
    <button mat-icon-button disabled></button>
    <mat-form-field *ngIf="editElement">
      <input #inputName aria-label="enter folder name" matInput (keydown.enter)="doSaveEnditElement()" [(ngModel)]="editElement!.name">
    </mat-form-field>
    <div class="app-action-bar">
      <button aria-label="save folder name" mat-raised-button color="primary" (click)="doSaveEnditElement()" [disabled]="editElement?.name == ''">
        <mat-icon fontIcon="save"></mat-icon>
        {{editElement?.id ? 'Save' : 'Create'}}
      </button>
      <button aria-label="cancel folder name change" mat-raised-button (click)="cancelEdit()">
        Cancel
      </button>
    </div>
  </mat-tree-node>

  <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
    <button mat-icon-button
            [attr.aria-label]="'Toggle ' + node.name" matTreeNodeToggle>
      <mat-icon class="mat-icon-rtl-mirror">
        {{ds.treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
      </mat-icon>
    </button>
    <ng-container [ngTemplateOutlet]="nameAndDate" [ngTemplateOutletContext]="{node}"></ng-container>
    <ng-container [ngTemplateOutlet]="defaultButtons" [ngTemplateOutletContext]="{node}"></ng-container>
  </mat-tree-node>

  <mat-tree-node *matTreeNodeDef="let node; when: isEmptyFolder" matTreeNodePadding>
    <button mat-icon-button disabled></button>
    <ng-container [ngTemplateOutlet]="nameAndDate" [ngTemplateOutletContext]="{node}"></ng-container>
    <ng-container [ngTemplateOutlet]="defaultButtons" [ngTemplateOutletContext]="{node}"></ng-container>
  </mat-tree-node>
</mat-tree>  
